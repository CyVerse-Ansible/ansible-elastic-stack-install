---
- name: Verify Logstash Directory Layout - w/ `es_instance_name`
  hosts: localhost
  remote_user: root
  pre_tasks:
     - when: es_home != '/usr/share/{{ES_PACKAGE}}'
       fail: 
         msg: "es_home = {{es_home}}, but should be '/usr/share/{{ES_PACKAGE}}'"

     - when: instance_dir_suffix != '{{inventory_hostname}}-{{es_instance_name}}'
       fail: 
         msg: "instance_dir_suffix = {{instance_dir_suffix}}, but should be '{{inventory_hostname}}-{{es_instance_name}}'"

     - when: conf_dir != '/etc/{{ES_PACKAGE}}/{{es_instance_name}}'
       fail: 
         msg: "conf_dir = {{conf_dir}}, but should be '/etc/{{ES_PACKAGE}}/{{es_instance_name}}'"

     - when: "data_dir != '/var/lib/{{ES_PACKAGE}}/{{instance_dir_suffix}}'"
       fail: 
         msg: "data_dir = {{data_dir}}, but should be '/var/lib/{{ES_PACKAGE}}/{{instance_dir_suffix}}'"

     - when: log_dir != '/var/log/{{ES_PACKAGE}}/{{instance_dir_suffix}}'
       fail: 
         msg: "log_dir = {{log_dir}}, but should be '/var/log/{{ES_PACKAGE}}/{{instance_dir_suffix}}'"

     - when: pid_dir != '/var/run/{{ES_PACKAGE}}/{{instance_dir_suffix}}'
       fail: 
         msg: "pid_dir = {{pid_dir}}, but should be '/var/run/{{ES_PACKAGE}}/{{instance_dir_suffix}}'"

  roles:
    - role_under_test
  post_tasks:
     - when: use_system_d and
             instance_sysd_script != '/usr/lib/systemd/system/{{instance_sys_file_name}}.service'
       fail: 
         msg: "instance_sysd_script = {{instance_sysd_script}}, but should be '/usr/lib/systemd/system/{{instance_sys_file_name}}.service'"

     - when: not use_system_d and 
             instance_init_script != '/etc/init.d/{{instance_sys_file_name}}'
       fail: 
         msg: "instance_init_script = {{instance_init_script}}, but should be '/etc/init.d/{{instance_sys_file_name}}'"

     - when: instance_default_file is defined and
             instance_default_file != "{{default_file | dirname}}/{{instance_sys_file_name}}"
       fail: 
         msg: "instance_default_file = {{instance_default_file}}, but should be  '{{default_file | dirname}}/{{instance_sys_file_name}}'"

